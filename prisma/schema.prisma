generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model Employee {
  EmployeeID   Int       @id(map: "PK__Employee__7AD04FF1897BF541") @default(autoincrement())
  FirstName    String    @db.NVarChar(100)
  LastName     String    @db.NVarChar(100)
  Email        String    @unique(map: "UQ__Employee__A9D10534F7B3A8BC") @db.NVarChar(150)
  PasswordHash String    @db.NVarChar(255)
  CreatedAt    DateTime? @default(now(), map: "DF__Employee__Create__0169315C") @db.DateTime
  WorkLog      WorkLog[]
}

model WorkLog {
  LogID            Int           @id(map: "PK__WorkLog__5E5499A83347C5FB") @default(autoincrement())
  EmployeeID       Int
  TemplateID       Int?
  WorkDate         DateTime?     @default(dbgenerated("CONVERT([date],getdate())"), map: "DF__WorkLog__WorkDat__08162EEB") @db.Date
  LoginTime        DateTime?     @db.DateTime
  LogoutTime       DateTime?     @db.DateTime
  TotalWorkedHours Decimal?      @db.Decimal(17, 6)
  Employee         Employee      @relation(fields: [EmployeeID], references: [EmployeeID], onUpdate: NoAction, map: "FK__WorkLog__Employe__062DE679")
  WorkTemplate     WorkTemplate? @relation(fields: [TemplateID], references: [TemplateID], onDelete: NoAction, onUpdate: NoAction, map: "FK__WorkLog__Templat__07220AB2")
}

model WorkTemplate {
  TemplateID   Int       @id(map: "PK__WorkTemp__F87ADD07A2601952") @default(autoincrement())
  TemplateName String    @db.NVarChar(100)
  StartTime    DateTime  @db.Time
  EndTime      DateTime  @db.Time
  DefaultHours Int?
  WorkLog      WorkLog[]
}

model tblEmailVerification {
  id        BigInt    @id @default(autoincrement())
  email     String    @db.Text
  otp       String    @db.Text
  expires   DateTime  @default(dbgenerated("sysutcdatetime()"))
  verified  Int       @default(0)
  created   DateTime  @default(dbgenerated("sysutcdatetime()"))
}

model tblUser {
  id              BigInt    @id @default(autoincrement())
  email           String    @unique @db.VarChar(60)
  fname           String?   @db.NVarChar(30)
  lname           String?   @db.NVarChar(30)
  created         DateTime  @default(dbgenerated("sysutcdatetime()"))
  profile_picture String?   @db.NVarChar
  access_level    Int       @default(99)
  password        String?   @db.VarChar(255)
  last_activity   DateTime  @default(dbgenerated("sysutcdatetime()"))

  tblAccountUsers tblAccountUser[]
  history         tblUserHistory[]
}

model tblAccount {
  id           BigInt     @id @default(autoincrement())
  name         String     @db.NVarChar(30)
  subscription String?    @db.VarChar(30)
  created      DateTime   @default(dbgenerated("sysutcdatetime()"))
  last_activity DateTime  @default(dbgenerated("sysutcdatetime()"))
  tblInvitation  tblInvitation[]
  tblAccountUsers tblAccountUser[]
}

model tblInvitation {
  id        BigInt    @id @default(autoincrement())
  email     String    @db.VarChar(60)
  account_id BigInt
  created   DateTime  @default(dbgenerated("sysutcdatetime()"))
  expires   DateTime  @default(dbgenerated("dateadd(week,(2),sysutcdatetime())"))
  status    String?   @db.VarChar(20)
  role      Int?      @db.TinyInt
  tblAccount    tblAccount    @relation(fields: [account_id], references: [id], onUpdate: NoAction, onDelete: NoAction)

  @@index([email], map: "IX_tblInvitations_email")
}
model tblAccountUser {
  account_id   BigInt
  user_id      BigInt
  access_level Int?      @db.TinyInt

  @@id([account_id, user_id])
  @@index([account_id])
  @@index([user_id])

  tblAccount  tblAccount @relation(fields: [account_id], references: [id])
  tblUser     tblUser    @relation(fields: [user_id], references: [id])
}
model tblUserHistory {
  id         BigInt    @id @default(autoincrement())
  user_id    BigInt
  itemId     String
  path       String
  hDateTime  DateTime  @default(now())

  // Relations
  user tblUser @relation(fields: [user_id], references: [id])

  @@index([user_id])
  @@map("tblUserHistory")
}